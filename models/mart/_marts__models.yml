version: 2

models:
  - name: fct_customer_orders
    description: "Fact table summarizing customer order activity"
    columns:
      - name: customer_id
        description: "The unique identifier for a customer"
        tests:
          - unique
          - not_null
      - name: unique_id
        description: "Unique identifier for the customer across the system"
        tests:
          - not_null
      - name: city
        description: "City of the customer"
      - name: state
        description: "State of the customer"
      - name: number_of_orders
        description: "Total number of orders placed by the customer"
        tests:
          - not_null
      - name: first_order_date
        description: "Date of the customer's first order"
        tests:
          - not_null
      - name: most_recent_order_date
        description: "Date of the customer's most recent order"
        tests:
          - not_null
      - name: number_of_delivered_orders
        description: "Total number of orders delivered to the customer"
        tests:
          - not_null

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - customer_id
            - unique_id

    config:
      materialized: table
      tags: ['mart', 'customer_orders']

  - name: fct_product_performance
    description: "Fact table summarizing product performance metrics"
    columns:
      - name: product_id
        description: "The unique identifier for a product"
        tests:
          - unique
          - not_null
      - name: product_category_name
        description: "The category name of the product"
      - name: number_of_orders
        description: "Total number of orders for this product"
        tests:
          - not_null
      - name: total_revenue
        description: "Total revenue generated by this product"
        tests:
          - not_null
      - name: average_price
        description: "Average price of the product"
        tests:
          - not_null
      - name: total_freight_value
        description: "Total freight value for this product"
        tests:
          - not_null
      - name: delivered_orders
        description: "Number of delivered orders for this product"
        tests:
          - not_null
      - name: avg_shipping_time
        description: "Average shipping time in days for this product"
        tests:
          - not_null

  - name: fct_customer_lifetime_value
    description: "Fact table for customer lifetime value analysis"
    columns:
      - name: customer_id
        description: "The unique identifier for a customer"
        tests:
          - unique
          - not_null
      - name: unique_id
        description: "Unique identifier for the customer across the system"
      - name: annual_customer_value
        description: "Predicted annual value of the customer"
      - name: predicted_customer_lifetime_value
        description: "Predicted lifetime value of the customer"

  - name: fct_sales_trends
    description: "Fact table for sales trends analysis"
    columns:
      - name: date
        description: "The date of the sales aggregation"
        tests:
          - not_null
      - name: total_sales
        description: "Total sales for the period"
        tests:
          - not_null
      - name: order_count
        description: "Number of orders for the period"
        tests:
          - not_null
      - name: average_order_value
        description: "Average order value for the period"
      - name: granularity
        description: "Time granularity of the aggregation (daily, weekly, monthly)"
        tests:
          - accepted_values:
              values: ['daily', 'weekly', 'monthly']